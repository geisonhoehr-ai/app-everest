# üîß Instru√ß√µes para Corrigir Permiss√µes de Administrador

## ‚ö†Ô∏è Problema Identificado

O sistema est√° deslogando administradores automaticamente ao acessar:
- Gest√£o de Turmas
- M√≥dulos
- Calend√°rio
- Qualquer p√°gina que fa√ßa queries nas tabelas do sistema

**Causa:** As RLS (Row Level Security) policies n√£o permitem que administradores acessem as tabelas, mesmo autenticados.

## ‚úÖ Solu√ß√£o

Execute o arquivo SQL que corrige todas as permiss√µes.

### Passo a Passo:

1. **Abra o Supabase Dashboard**
   - Acesse: https://app.supabase.com
   - Fa√ßa login
   - Selecione seu projeto

2. **Abra o SQL Editor**
   - No menu lateral, clique em "SQL Editor"
   - Ou acesse diretamente: `https://app.supabase.com/project/SEU_PROJECT_ID/sql`

3. **Execute o SQL**
   - Clique em "New Query"
   - Copie TODO o conte√∫do do arquivo `FIX_ADMIN_PERMISSIONS_SAFE.sql`
   - Cole no editor
   - Clique em "Run" (ou pressione Ctrl+Enter)

4. **Verifique a Execu√ß√£o**
   - Voc√™ deve ver mensagens de sucesso como:
     ```
     ‚úÖ Classes policies created
     ‚úÖ Users policies created
     ‚úÖ Students policies created
     ‚úÖ Teachers policies created
     ‚úÖ Subjects policies created
     ‚úÖ Flashcards policies created
     ‚úÖ Video_courses policies created
     ‚úÖ Admin permissions configured successfully!
     ```

5. **Teste o Sistema**
   - Fa√ßa logout da aplica√ß√£o
   - Fa√ßa login novamente como administrador
   - Tente acessar "Gest√£o de Turmas"
   - Tente acessar "M√≥dulos"
   - Verifique se n√£o √© mais deslogado automaticamente

## üîç O que o SQL Faz

O arquivo cria:

1. **Fun√ß√µes Helper**
   - `is_admin()` - Verifica se o usu√°rio autenticado √© administrador
   - `is_authenticated()` - Verifica se h√° usu√°rio autenticado

2. **Policies para Administradores**
   - Acesso TOTAL (SELECT, INSERT, UPDATE, DELETE) para admins
   - Em TODAS as tabelas do sistema

3. **Policies para Usu√°rios Comuns**
   - Acesso SELECT (leitura) para usu√°rios autenticados
   - Restri√ß√µes espec√≠ficas por tabela

## ‚ö° Por que isso √© Seguro

- O SQL verifica se cada tabela EXISTE antes de aplicar as policies
- N√£o cria tabelas novas
- N√£o modifica dados existentes
- Apenas configura as permiss√µes de acesso

## üìù Tabelas Afetadas

O SQL configura permiss√µes para:
- classes
- users
- student_classes
- class_feature_permissions
- students
- teachers
- subjects
- flashcards
- video_courses

Se alguma tabela n√£o existir, ela √© simplesmente ignorada (n√£o causa erro).

## üêõ Se Algo Der Errado

Se encontrar erros ao executar:

1. Verifique se voc√™ est√° logado como OWNER do projeto
2. Copie o erro completo
3. Compartilhe comigo para an√°lise

## ‚è≠Ô∏è Pr√≥ximos Passos

Ap√≥s executar o SQL com sucesso:

1. Teste o acesso a todas as p√°ginas admin
2. Verifique se consegue criar/editar:
   - Turmas
   - Alunos
   - Professores
   - Flashcards
   - V√≠deos
3. Confirme que o logout autom√°tico parou

---

**Arquivo a executar:** `migrations/FIX_ADMIN_PERMISSIONS_SAFE.sql`

**Tempo estimado:** 2-3 minutos
