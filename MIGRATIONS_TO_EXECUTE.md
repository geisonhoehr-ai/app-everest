# üîß Migrations Pendentes - Execute no Supabase

## ‚ö†Ô∏è IMPORTANTE
As migrations abaixo precisam ser executadas manualmente no Supabase SQL Editor com permiss√µes de administrador.

## üìù Migration: Melhorias para Administra√ß√£o

**Arquivo**: `supabase/migrations/20250930000000_enhance_admin_features.sql`

### O que essa migration faz:

1. **Adiciona categoria √†s conquistas (achievements)**
   - Campo `category` para organizar conquistas por tipo
   - Valores: `general`, `study`, `quiz`, `essay`, `social`

2. **Adiciona status √†s turmas (classes)**
   - Enum `class_status` com valores: `active`, `inactive`, `archived`
   - Permite melhor controle do ciclo de vida das turmas

3. **Melhora sistema de gamifica√ß√£o (user_progress)**
   - `total_xp`: XP total acumulado pelo usu√°rio
   - `level`: N√≠vel atual baseado no XP
   - `current_streak_days`: Sequ√™ncia atual de dias estudando
   - `longest_streak_days`: Maior sequ√™ncia alcan√ßada
   - `last_activity_date`: √öltima data de atividade

4. **Cria views para otimiza√ß√£o**
   - `class_stats`: Estat√≠sticas agregadas de turmas
   - `user_ranking`: Ranking global de estudantes por XP

5. **Cria fun√ß√£o √∫til**
   - `get_achievement_unlock_count()`: Retorna quantas vezes uma conquista foi desbloqueada

6. **Configura pol√≠ticas RLS**
   - Todos podem ver conquistas
   - Apenas admins/professores podem gerenciar conquistas
   - Usu√°rios veem suas pr√≥prias conquistas desbloqueadas

## üöÄ Como Executar

1. Acesse o Supabase Dashboard
2. V√° em **SQL Editor**
3. Crie uma nova query
4. Copie e cole todo o conte√∫do do arquivo `supabase/migrations/20250930000000_enhance_admin_features.sql`
5. Execute a query
6. Verifique se n√£o houve erros

## ‚úÖ Verifica√ß√£o

Ap√≥s executar, verifique se os seguintes comandos retornam dados:

```sql
-- Verificar se a coluna category foi adicionada
SELECT column_name FROM information_schema.columns 
WHERE table_name = 'achievements' AND column_name = 'category';

-- Verificar se a coluna status foi adicionada
SELECT column_name FROM information_schema.columns 
WHERE table_name = 'classes' AND column_name = 'status';

-- Verificar se as colunas de gamifica√ß√£o foram adicionadas
SELECT column_name FROM information_schema.columns 
WHERE table_name = 'user_progress' 
AND column_name IN ('total_xp', 'level', 'current_streak_days');

-- Verificar se a view foi criada
SELECT * FROM public.class_stats LIMIT 1;
SELECT * FROM public.user_ranking LIMIT 1;
```

## üìå Nota

As p√°ginas administrativas **j√° est√£o preparadas** para funcionar com ou sem essas migrations:
- ‚úÖ Se a migration foi executada: usa as views otimizadas
- ‚úÖ Se n√£o foi executada: usa queries alternativas (fallback)

Isso garante que o sistema funcione imediatamente, mas executar a migration melhora a performance!

